function addToCart() {
        const selectedDesigns = Array.from(dom.interactiveBundleSelector.querySelectorAll('input:checked')).map(input => ({
            name: input.dataset.name,
            image: input.dataset.image
        }));
        
        if (selectedDesigns.length === 0) {
            alert("Please select at least one design.");
            return;
        }

        // Prepare data for FB Pixel *before* looping and adding to cart
        let pixel_content_ids = [];
        let pixel_value = 0;
        const bundlePrices = product.bundlePrices.map(p => parseFloat(p.replace('$', '')));

        selectedDesigns.forEach((design, index) => {
            const variantId = `${design.name}|${Date.now()}`; // Generate unique ID
            let price = bundlePrices[Math.min(index, bundlePrices.length - 1)]; // Get correct bundle price

            // Add item to the main cart array
            cart.push({
                productId: 'mainProduct', // Use a consistent ID for the base product
                variantId: variantId,      // Unique ID for this specific added item
                name: product.name,
                price: `$${price.toFixed(2)}`, // Store formatted price
                image: design.image,
                variantText: design.name,
                quantity: 1
            });

            // Aggregate data for the Pixel event
            pixel_content_ids.push(variantId); // Use the unique variant ID
            pixel_value += price;
        });

        // --- ADD THIS ENHANCED FB PIXEL CODE ---
        if (typeof fbq === 'function') { // Check if fbq is loaded
            try {
                fbq('track', 'AddToCart', {
                    content_ids: pixel_content_ids,     // Array of variant IDs added
                    content_name: product.name,        // Base product name
                    content_type: 'product',
                    value: pixel_value,             // Total value of items added in this click
                    currency: 'USD'                 // IMPORTANT: Change 'USD' if needed
                });
            } catch (e) {
                console.error("FB Pixel AddToCart Error:", e);
            }
        }
        // --- END OF ENHANCED FB PIXEL CODE ---

        saveState();
        renderCart();
        showItemAddedPopup({ mediaUrl: selectedDesigns[0].image, mediaType: 'image' }, `Added <strong>${selectedDesigns.length} items</strong> to your cart!`);
        
        startCartTimer(); 
        // REMOVE the old, basic fbq('track', 'AddToCart'); line if it exists elsewhere
    }
