<!DOCTYPE html>
<html lang="en">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>Limited Time Offer! - Balaclava</title>
Â  Â  <script src="https://js.stripe.com/v3/"></script>
Â  Â  <script src="https://cdn.tailwindcss.com"></script>
Â  Â  <link rel="preconnect" href="https://fonts.googleapis.com">
Â  Â  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
Â  Â  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap" rel="stylesheet">
Â  Â Â 
Â  Â  <script async src="https://www.googletagmanager.com/gtag/js?id=GA_MEASUREMENT_ID"></script>
Â  Â  <script>
Â  Â  Â  window.dataLayer = window.dataLayer || [];
Â  Â  Â  function gtag(){dataLayer.push(arguments);}
Â  Â  Â  gtag('js', new Date());
Â  Â  Â  gtag('config', 'GA_MEASUREMENT_ID');
Â  Â  </script>
Â  Â  <script>
Â  Â  Â  !function(f,b,e,v,n,t,s)
Â  Â  Â  {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
Â  Â  Â  n.callMethod.apply(n,arguments):n.queue.push(arguments)};
Â  Â  Â  if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
Â  Â  Â  n.queue=[];t=b.createElement(e);t.async=!0;
Â  Â  Â  t.src=v;s=b.getElementsByTagName(e)[0];
Â  Â  Â  s.parentNode.insertBefore(t,s)}(window, document,'script',
Â  Â  Â  'https://connect.facebook.net/en_US/fbevents.js');
Â  Â  Â  fbq('init', '757946737591863');Â 
Â  Â  Â  fbq('track', 'PageView');
Â  Â  </script>
Â  Â  <noscript><img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id=757946737591863&ev=PageView&noscript=1"/></noscript>
Â  Â Â 
Â  Â  <style>
Â  Â  Â  Â  body { font-family: "Bebas Neue", sans-serif; transition: background-color 0.3s ease; background-size: cover; background-position: center; background-attachment: fixed; }
Â  Â  Â  Â  body[data-theme="light"], body { --color-urgent: #ef4444; --color-accent: #4f46e5; --color-accent-hover: #4338ca; --color-accent-border: #4f46e5; }
Â  Â  Â  Â  body[data-theme="dark"] { --color-urgent: #d946ef; --color-accent: #ec4899; --color-accent-hover: #db2777; --color-accent-border: #ec4899; }
Â  Â  Â  Â  .timer-box { background-color: var(--color-urgent); animation: pulse 1.5s infinite; }
Â  Â  Â  Â  @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.02); } }
Â  Â  Â  Â  .add-to-cart-button { background-color: var(--color-accent); transition: background-color 0.3s; }
Â  Â  Â  Â  .add-to-cart-button:hover { background-color: var(--color-accent-hover); }
Â  Â  Â  Â  .text-highlight { color: var(--color-accent); }
Â  Â  Â  Â  #cart-panel { position: fixed; top: 0; right: -100%; width: 100%; max-width: 400px; height: 100%; background-color: white; color: #333; box-shadow: -10px 0 30px rgba(0,0,0,0.1); z-index: 110; transition: right 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94); display: flex; flex-direction: column; }
Â  Â  Â  Â  #cart-panel.open { right: 0; }
Â  Â  Â  Â  #cart-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.6); z-index: 105; }
Â  Â  Â  Â  #cart-overlay.open { display: block; }
Â  Â  Â  Â  .modal { display: none; position: fixed; z-index: 120; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.6); }
Â  Â  Â  Â  .modal-content { background-color: #fefefe; color: #333; margin: 2% auto; padding: 2rem; border: 1px solid #888; width: 90%; max-width: 600px; border-radius: 10px; max-height: 90vh; overflow-y: auto;}
Â  Â  Â  Â  .close-modal { color: #aaa; float: right; font-size: 28px; font-weight: bold; cursor: pointer; }
Â  Â  Â  Â  #social-proof-popup { display: none; position: fixed; bottom: 20px; left: 20px; background-color: white; color: #333; padding: 15px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.2); z-index: 200; opacity: 0; transform: translateY(20px); transition: opacity 0.5s, transform 0.5s; }
Â  Â  Â  Â  #social-proof-popup.show { display: block; opacity: 1; transform: translateY(0); }
Â  Â  Â  Â  #public-cart-button { position: fixed; bottom: 20px; right: 20px; background-color: var(--color-accent); color: white; width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 12px rgba(0,0,0,0.2); cursor: pointer; z-index: 100; transition: transform 0.2s; }
Â  Â  Â  Â  #public-cart-button:hover { transform: scale(1.1); }
Â  Â  Â  Â  #public-cart-badge { position: absolute; top: -5px; right: -5px; background-color: var(--color-urgent); color: white; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: bold; }
Â  Â  Â  Â  .bundle-image-option input:checked + label { border-color: var(--color-accent); box-shadow: 0 0 0 3px var(--color-accent); }
Â  Â  Â  Â  .bundle-image-option input:checked + label .bundle-checkmark { opacity: 1; transform: scale(1); }
Â  Â  Â  Â  .related-product-card { border: 1px solid #e5e7eb; border-radius: 0.5rem; overflow: hidden; transition: box-shadow 0.2s; text-decoration: none; }
Â  Â  Â  Â  .related-product-card:hover { box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1); }
Â  Â  Â  Â  .related-product-card img { aspect-ratio: 1 / 1; object-fit: cover; width: 100%; }
Â  Â  Â  Â  .related-product-card-info { padding: 0.75rem; text-align: center; }
Â  Â  Â  Â  #payment-method-messaging { min-height: 20px; }
Â  Â  </style>
</head>
<body data-theme="dark">

Â  Â  <div id="public-cart-button">
Â  Â  Â  Â  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" /></svg>
Â  Â  Â  Â  <span id="public-cart-badge">0</span>
Â  Â  </div>
Â  Â  <div id="social-proof-popup"></div>
Â  Â  <div id="cart-overlay"></div>

Â  Â  <div id="cart-panel">
Â  Â  Â  Â  <div class="flex justify-between items-center p-4 border-b">
Â  Â  Â  Â  Â  Â  <h2 class="text-xl font-bold">Your Cart</h2>
Â  Â  Â  Â  Â  Â  <button id="close-cart-btn" class="text-2xl">&times;</button>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="p-4 bg-yellow-100 text-center">
Â  Â  Â  Â  Â  Â  <p class="font-semibold text-yellow-800" style="font-family: sans-serif;">Your items are reserved for <span id="cart-timer" class="font-bold">10:00</span>!</p>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div id="cart-items-container" class="flex-grow p-4 overflow-y-auto"></div>
Â  Â  Â  Â  <div class="p-4 border-t space-y-4">
Â  Â  Â  Â  Â  Â  <div class="flex justify-between font-bold text-lg">
Â  Â  Â  Â  Â  Â  Â  Â  <span>Subtotal</span>
Â  Â  Â  Â  Â  Â  Â  Â  <span id="cart-subtotal">$0.00</span>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <p class="text-sm text-gray-500 text-center" style="font-family: sans-serif;">Free Shipping on all orders!</p>
Â  Â  Â  Â  Â  Â  <button id="checkout-btn" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 rounded-lg text-lg">Pay with Card</button>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div id="theme-wrapper">
Â  Â  Â  Â  <div id="page-container">
Â  Â  Â  Â  Â  Â  <header class="py-4 absolute top-0 left-0 w-full z-10">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="container mx-auto px-4 flex justify-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <a href="/home.html"><img id="header-logo" alt="Brand Logo" class="h-10"></a>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </header>
Â  Â  Â  Â  Â  Â  <div class="container mx-auto p-4 max-w-5xl pt-20">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="bg-red-600 text-white text-center p-3 rounded-lg shadow-lg timer-box mb-6">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h1 class="text-2xl font-bold">FLASH SALE! Ends In:</h1>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="countdown-timer" class="text-4xl" style="font-family: monospace;">00:00:00</div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="urgent-cta" class="text-center mb-6">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 id="cta-headline" class="text-2xl font-bold text-highlight animate-pulse"></h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p id="cta-subheadline" class="text-gray-500" style="font-family: sans-serif;"></p>
Ã‚ Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="bg-white rounded-xl shadow-2xl overflow-hidden">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="md:flex">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="media-container" class="md:w-1/2 p-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="main-product-video-container" class="aspect-w-16 aspect-h-9 rounded-lg overflow-hidden hidden"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img id="main-product-image" class="w-full aspect-square object-cover rounded-lg shadow-md" src="" alt="Main Product Image">
Ã‚ Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="product-details-container" class="p-8 md:w-1/2 flex flex-col justify-between">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="product-badge" class="uppercase tracking-wide text-sm text-highlight font-semibold"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 id="product-name" class="text-3xl font-bold text-gray-900 mt-2"></h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p id="product-description" class="mt-4 text-gray-600" style="font-family: sans-serif;"></p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="mt-6 flex items-baseline gap-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div><span class="text-gray-500 text-sm">Total Price</span><span id="product-price" class="text-4xl font-bold text-gray-900"></span></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div><span class="text-gray-500 text-sm">Was</span><span id="product-original-price" class="text-xl text-gray-500 line-through"></span></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="payment-method-messaging" class="mt-4" style="font-family: sans-serif;"></div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="interactive-bundle-selector" class="mt-6 space-y-3"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="bundle-summary" class="mt-4 space-y-2" style="display: none;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4 class="font-bold text-lg text-gray-800">Your Bundle:</h4>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="bundle-summary-items" class="text-gray-600" style="font-family: sans-serif;"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="stock-indicator" class="mt-4 bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 rounded-md">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="font-bold">Hurry! Only <span id="stock-count">12</span> left in stock!</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  _ </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Ã‚ Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="mt-8">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="add-to-cart-button" class="add-to-cart-button w-full text-white font-bold py-4 px-6 rounded-lg text-xl shadow-lg">Add to Cart</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Ã‚ Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="related-products-section" class="p-8 border-t border-gray-200">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="text-lg font-bold mb-4 text-gray-900">You May Also Like</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="related-products-grid" class="grid grid-cols-3 gap-4">
Â  Â  Â  Â  Â  Â  Â  Â  Ã‚ Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="mt-12 space-y-8">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="shipping-section" class="bg-white p-8 rounded-lg shadow-md">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="text-2xl font-bold mb-4 text-gray-900">Shipping Information</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-gray-700" style="font-family: sans-serif;">Your order will be processed within 24 hours. **Expected shipping time is 2.5 weeks.** You'll receive a tracking number as soon as it ships.</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <footer class="text-center py-8 mt-12">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-gray-500" style="font-family: sans-serif;">Contact us: <a href="mailto:atfstoragexx@gmail.com" class="hover:underline">atfstoragexx@gmail.com</a></p>
Ã‚ Â  Â  Â  Â  Â  Â  Â  </footer>
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>
Â  Â Â 
Â  Â  <div id="add-to-cart-popup" class="modal">
Â  Â  Â  Â  <div class="modal-content text-center max-w-md">
Â  Â  Â  Â  Â  Â  <span class="close-modal" id="close-popup-btn">&times;</span>
Â  Â  Â  Â  Â  Â  <h3 class="text-2xl font-bold text-green-600 mb-4">Successfully Added!</h3>
Â  Â  Â  Â  Â  Â  <img id="popup-product-image" src="" alt="Product Image" class="w-32 h-32 object-cover mx-auto rounded-lg mb-4">
Â  Â  Â  Â  Â  Â  <p id="popup-message" class="text-gray-700 mb-6"></p>
Â  Â  Â  Â  Â  Â  <div class="space-y-3">
Â  Â  Â  Â  Â  Â  Â  Â  <button id="popup-view-cart" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 rounded-lg">View Cart & Checkout</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button id="popup-continue-shopping" class="w-full text-gray-600 hover:text-indigo-600 font-semibold py-2">Continue Shopping</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
Â  Â  const STRIPE_PUBLISHABLE_KEY = 'pk_live_51SIdrnHPi9QM97mFMDciuMPOW7GX2mXliZq769HyO6WKs52bIqwXbRg5nK1IDAIQFK8DYexoiZftmPYtx8WG1H2D001i6OPZZj';
Â  Â  const stripe = Stripe(STRIPE_PUBLISHABLE_KEY);
Â  Â  const elements = stripe.elements();
Â  Â  let paymentMessage = null;

Â  Â  const LOGO_URL_WHITE = 'https://i.imgur.com/7B5NkbX.png';
Â  Â  const LOGO_URL_BLACK = 'https://i.imgur.com/mY9JuRX.png';
Â  Â  const CHECKOUT_SESSION_URL = '/api/server';Â 
Â  Â Â 
Â  Â  let product = {};
Â  Â  let cart = [];
Â  Â  const appStateKey = 'singleProductPageState_v2';Â 
Â  Â Â 
Â  Â  let cartTimerInterval = null;
Â  Â  let flashSaleTimerInterval = null;

Â  Â  const initialProduct = {
Â  Â  Â  Â  name: 'ATF V1 "TakeOver" Balaclava [Final Run]',
Â  Â  Â  Â  description: 'The original ATF V1 "TakeOver" design. This is the final production run of this iconic piece. One size fits all. It\'s more than an accessory, it\'s a statement.',
Â  Â  Â  Â  ctaHeadline: 'It\'s Time For a TakeOver.',
Â  Â  Â  Â  ctaSubheadline: 'Designs so unique, they\'re not just accessoriesâ€”they\'re walking masterpieces.',
Â  Â  Â  Â  originalPrice: '$45.00',
Â  Â  Â  Â  theme: 'dark',
Â  Â  Â  Â  mediaType: 'video',
Â  Â  Â  Â  mediaUrl: 'https://www.youtube.com/embed/r6BjqteH-c8?autoplay=1&loop=1&playlist=r6BjqteH-c8&controls=0',
Â  Â  Â  Â  bundlePrices: ['$29.95', '$24.95', '$14.95'],
Â  _ Â  Â  Â  variations: {
Â  Â  Â  Â  Â  Â  'Design': [
Â  Â  Â  Â  Â  Â  Â  Â  { option: 'V1 - Turbo Edition', image: 'https://i.imgur.com/ghpj3Nm.png' },
Â  Â  Â  Â  Â  Â  Â  Â  { option: 'V1 - Burble Edition', image: 'https://i.imgur.com/9QcKSwf.png' },
Â  Â  Â  Â  Â  Â  Â  Â  { option: 'V1 - Burnout Edition', image: 'https://i.imgur.com/lLIgQjD.png' }
Â  Â  Â  Â  Â  Â  ]
Â  Â  Â  Â  }
Â  Â  };
Â  Â  // REVIEWS DATA REMOVED
Â  Â  const relatedProductsData = [
Â  Â  Â  Â  { name: 'ATFV12 HOODIE - ICE', image: 'https://i.imgur.com/TZw6FIE.png', url: '/hoodies.html' },
Â  Â  Â  Â  { name: 'ATFV12 HOODIE - OOTER', image: 'https://i.imgur.com/eaGeEEL.png', url: '/hoodies.html' },
Â  Â  Â  Â  { name: 'ATFV12 HOODIE - PREE', image: 'https://i.imgur.com/tUMU6TR.png', url: '/hoodies.html' }
Â  Â  ];

Â  Â  function saveState() {
Â  Â  Â  Â  localStorage.setItem(appStateKey, JSON.stringify({ cart }));
Â  Â  }

Â  Â  function loadState() {
Â  Â  Â  Â  product = initialProduct;
Â  Â  Â  Â  // reviews = initialReviews; // <-- REMOVED
Â  Â  Â  Â  const savedState = localStorage.getItem(appStateKey);
Â  Â  Â  Â  cart = savedState ? JSON.parse(savedState).cart || [] : [];
Â  Â  }

Â  Â  const dom = new Proxy({}, { get: (_, id) => document.getElementById(id.replace(/([A-Z])/g, "-$1").toLowerCase()) });

Â  Â  function updateCartIcon() {
Â  Â  Â  Â  const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
Â  Â  Â  Â  dom.publicCartBadge.textContent = totalItems;
Â  Â  }
Â  Â Â 
Â  Â  function renderCart() {
Â  Â  Â  Â  if (!dom.cartItemsContainer) return;
Â  Â  Â  Â  dom.cartItemsContainer.innerHTML = '';
Â  Â  Â  Â  let subtotal = 0;
Â  Â  Â  Â Â 
Â  Â  Â  Â  const productPrices = {
Â  Â  Â  Â  Â  Â  'mainProduct': ['$29.95', '$24.95', '$14.95'],
Â  Â  Â  Â  Â  Â  'hoodieProduct': ['$59.95']
Â  Â  Â  Â  };

Â  Â  Â  Â  const bundleGroups = {};
Â  Â  Â  Â  cart.forEach(item => {
Â  Â  Â  Â  Â  Â  const productId = item.productId || 'mainProduct';Â 
Â  Â  Â  Â  Â  Â  if (!bundleGroups[productId]) bundleGroups[productId] = [];
Â  Â  Â  Â  Â  Â  bundleGroups[productId].push(item);
Â  Â  Â  Â  });

Â  Â  Â  Â  for (const productId in bundleGroups) {
Â  Â  Â  Â  Â  Â  const items = bundleGroups[productId];
Â  Â  Â  Â  Â  Â  const prices = productPrices[productId] || ['$99.99'];
Â  Â  Â  Â  Â  Â  const bundlePrices = prices.map(p => parseFloat(p.replace('$', '')));
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  items.forEach((item, index) => {
Â  Â  Â  Â  Â  Â  Â  Â  let price = bundlePrices[Math.min(index, bundlePrices.length - 1)];
Â  Â  Â  Â  Â  Â  Â  Â  item.price = `$${price.toFixed(2)}`;
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (cart.length === 0) {
Â  Â  Â  Â  Â  Â  dom.cartItemsContainer.innerHTML = `<p class="text-center text-gray-500">Your cart is empty.</p>`;
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  cart.forEach(item => {
Â  Â  Â  Â  Â  Â  Â  Â  const itemEl = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  itemEl.className = 'flex items-center space-x-4 py-3 border-b';
Â  Â  Â  Â  Â  Â  Â  Â  itemEl.dataset.variantId = item.variantId;
Â  Â  Â  Â  Â  Â  Â  Â  const price = parseFloat(item.price.replace('$', ''));
Â  Â  Â  Â  Â  Â  Â  Â  subtotal += price * item.quantity;
Â  Â  Â  Â  Â  Â  Â  Â  itemEl.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src="${item.image}" alt="${item.name}" class="w-16 h-16 object-cover rounded-md">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex-grow">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="font-semibold">${item.name}</p>
Ã‚ Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm text-gray-500">${item.variantText}</p>Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="font-bold text-sm">${item.price}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="remove-item-btn text-red-500 hover:text-red-700 font-bold text-xl px-2" data-variant-id="${item.variantId}">&times;</button>
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  dom.cartItemsContainer.appendChild(itemEl);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }
Â  Â  Â  Â  if (dom.cartSubtotal) dom.cartSubtotal.textContent = `$${subtotal.toFixed(2)}`;
Â  Â  Â  Â  updateCartIcon();
Â  Â  }

Â  Â  function addToCart() {
Â  Â  Â  Â  const selectedDesigns = Array.from(dom.interactiveBundleSelector.querySelectorAll('input:checked')).map(input => ({
Â  Â  Â  Â  Â  Â  name: input.dataset.name,
Â  Â  Â  Â  Â  Â  image: input.dataset.image
Â  Â  Â  Â  }));
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (selectedDesigns.length === 0) {
Â  Â  Â  Â  Â  Â  alert("Please select at least one design.");
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- New variables for tracking ---
Â  Â  Â  Â  let itemsForGtag = [];
Â  Â  Â  Â  let totalValue = 0;
Â  Â  Â  Â  const bundlePrices = product.bundlePrices.map(p => parseFloat(p.replace('$', '')));
Â  Â  Â  Â  // --- End new variables ---

Â  Â  Â  Â  selectedDesigns.forEach((design, index) => {
Â  Â  Â  Â  Â  Â  const variantId = `${design.name}|${Date.now()}`;
Â  Â  Â  Â  Â  Â  let price = bundlePrices[Math.min(index, bundlePrices.length - 1)];
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  cart.push({
Â  Â  Â  Â  Â  Â  Â  Â  productId: 'mainProduct',
Â  Â  Â  Â  Â  Â  Â  Â  variantId: variantId,
Â  Â  Â  Â  Â  Â  Â  Â  name: product.name,
Â  Â  Â  Â  Â  Â  Â  Â  price: `$${price.toFixed(2)}`, // Use calculated price
Â  Â  Â  Â  Â  Â  Â  Â  image: design.image,
Â  Â  Â  Â  Â  Â  Â  Â  variantText: design.name,
Â  Â  Â  Â  Â  Â  Â  Â  quantity: 1
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  // --- Build the item for Google Analytics ---
Â  Â  Â  Â  Â  Â  itemsForGtag.push({
Â  Â  Â  Â  Â  Â  Â  Â  item_id: variantId,
Â  Â  Â  Â  Â  Â  Â  Â  item_name: product.name,
Â  Â  Â  Â  Â  Â  Â  Â  item_variant: design.name,
Â  Â  Â  Â  Â  Â  Â  Â  price: price,
Â  Â  Â  Â  Â  Â  Â  Â  quantity: 1
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  totalValue += price;
Â  Â  Â  Â  Â  Â  // --- End gtag item build ---
Â  Â  Â  Â  });

Â  Â  Â  Â  saveState();
Â  Â  Â  Â  renderCart();
Â  Â  Â  Â  showItemAddedPopup({ mediaUrl: selectedDesigns[0].image, mediaType: 'image' }, `Added <strong>${selectedDesigns.length} items</strong> to your cart!`);
Â  Â  Â  Â Â 
Â  Â  Â  Â  startCartTimer();Â 
Â  Â  Â  Â Â 
Â  Â  Â  Â  // --- PIXEL TRACKING ---
Â  Â  Â  Â  fbq('track', 'AddToCart');Â 
Â  Â  Â  Â Â 
Â  Â  Â  Â  gtag('event', 'add_to_cart', {
Â  Â  Â  Â  Â  Â  currency: 'USD',
Â  Â  Â  Â  Â  Â  value: totalValue,
Â  Â  Â  Â  Â  Â  items: itemsForGtag
Â  Â  Â  Â  });
Â  Â  }
Â  Â Â 
Â  Â  function showItemAddedPopup(popupProduct, message) {
Read Â  Â  if (!dom.addToCartPopup) return;
Â  Â  Â  Â  clearTimeout(dom.popupTimeout);
Â  Â  Â  Â  dom.popupProductImage.src = popupProduct.mediaUrl || 'https://placehold.co/128x128';
Â  Â  Â  Â  dom.popupMessage.innerHTML = message;
Â  Â  Â  Â  dom.addToCartPopup.style.display = 'block';
Â  Â  Â  Â  dom.popupTimeout = setTimeout(() => { dom.addToCartPopup.style.display = 'none'; }, 5000);
D Â  }

Â  Â  function updateBundleSummary() {
Â  Â  Â  Â  const selectedInputs = Array.from(dom.interactiveBundleSelector.querySelectorAll('input:checked'));
Â  Â  Â  Â  const bundlePrices = product.bundlePrices.map(p => parseFloat(p.replace('$', '')));
Â  Â  Â  Â  let total = 0;
Â  Â  Â  Â  let originalTotal = 0;
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (dom.bundleSummaryItems) dom.bundleSummaryItems.innerHTML = '';
Â  Â  Â  Â  if (selectedInputs.length > 0) {
Â  Â  Â  Â  Â  Â  if (dom.bundleSummary) dom.bundleSummary.style.display = 'block';
Â  Â  Â  Â  Â  Â  selectedInputs.forEach((input, index) => {
Â  Â  Â  Â  Â  Â  Â  Â  let price = bundlePrices[Math.min(index, bundlePrices.length - 1)];
Â  Â  Â  Â  Â  Â  Â  Â  total += price;
Â  Â  Â  Â  Â  Â  Â  Â  originalTotal += parseFloat(product.originalPrice.replace('$', ''));
Â  Â  Â  Â  Â  Â  Â  Â  const itemEl = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  itemEl.className = 'flex justify-between items-center text-sm';
Â  Â  Â  Â  Â  Â  Â  Â  itemEl.innerHTML = `<span>Item ${index + 1}: ${input.dataset.name}</span><span class="font-bold">$${price.toFixed(2)}</span>`;
Â  Â  Â  Â  Â  Â  Â  Â  if (dom.bundleSummaryItems) dom.bundleSummaryItems.appendChild(itemEl);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  if (dom.bundleSummary) dom.bundleSummary.style.display = 'none';
Â  Â  Â  Â  }
Â  Â  Â  Â  if (dom.productPrice) dom.productPrice.textContent = `$${total.toFixed(2)}`;
Â  Â  Â  Â  if (dom.productOriginalPrice) dom.productOriginalPrice.textContent = `$${originalTotal.toFixed(2)}`;
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (paymentMessage && total > 0) {
Â  Â  Â  Â  Â  Â  const totalInCents = Math.round(total * 100);
Â  Â  Â  Â  Â  Â  paymentMessage.update({ amount: totalInCents, currency: 'USD' });
Â  Â  Â  Â  }
Â  Â  }

Â  Â  function renderProduct() {
Â  Â  Â  Â  document.body.dataset.theme = product.theme || 'light';
Â  Â  Â  Â  dom.headerLogo.src = (product.theme === 'light') ? LOGO_URL_BLACK : LOGO_URL_WHITE;
Â  Â  Â  Â  dom.productName.textContent = product.name;
Â  Â  Â  Â  dom.productDescription.textContent = product.description;
Â  Â  Â  Â  dom.ctaHeadline.textContent = product.ctaHeadline;
Â  Â  Â  Â  dom.ctaSubheadline.textContent = product.ctaSubheadline;
Â  Â  Â  Â  dom.productBadge.textContent = 'Limited Edition Bundle Deal';

Â  Â  Â  Â  if (product.mediaType === 'video' && product.mediaUrl) {
Â  Â  Â  Â  Â  Â  dom.mainProductImage.style.display = 'none';
Â  Â  Â  Â  Â  Â  dom.mainProductVideoContainer.style.display = 'block';
Â  Â  Â  Â  Â  Â  dom.mainProductVideoContainer.innerHTML = `<iframe class="w-full h-full aspect-video" src="${product.mediaUrl}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>`;
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  dom.mainProductImage.style.display = 'block';
Â  Â  Â  Â  Â  Â  dom.mainProductVideoContainer.style.display = 'none';
Â  Â  Â  Â  Â  Â  dom.mainProductImage.src = product.mediaUrl || 'https://placehold.co/600x600';
Â  Â  Â  Â  }

Â  Â  Â  Â  dom.interactiveBundleSelector.innerHTML = '<h4 class="font-bold text-lg text-gray-800 mb-2">Build Your Bundle & Save!</h4><div class="grid grid-cols-2 sm:grid-cols-3 gap-3"></div>';
A Â  Â  Â  const gridContainer = dom.interactiveBundleSelector.querySelector('.grid');
Â  Â  Â  Â  const designKey = Object.keys(product.variations)[0];

Â  Â  Â  Â  if (designKey) {
Â  Â  Â  Â  Â  Â  product.variations[designKey].forEach(variation => {
Â  Â  Â  Â  Â  Â  Â  Â  const optionId = `bundle-opt-${variation.option.replace(/\s+/g, '-')}`;
Â  Â  Â  Â  Â  Â  Â  Â  const optionEl = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  optionEl.className = 'bundle-image-option';
Â  Â  Â  Â  Â  Â  Â  Â  optionEl.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="checkbox" id="${optionId}" data-name="${variation.option}" data-image="${variation.image}" class="sr-only">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="${optionId}" class="block relative border-2 border-gray-200 rounded-lg cursor-pointer transition-all p-1">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src="${variation.image}" class="w-full h-24 object-cover rounded-md">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-center text-sm font-semibold mt-1">${variation.option}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="bundle-checkmark absolute top-1 right-1 h-6 w-6 bg-white/70 rounded-full flex items-center justify-center opacity-0 transform scale-75">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <svg class="h-4 w-4 text-white" style="fill: var(--color-accent);" viewBox="0 0 20 20"><path d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"/></svg>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </label>
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  gridContainer.appendChild(optionEl);
Â  Â  Â  Â  Â  Â  Â  Â  optionEl.querySelector('label').addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.mainProductImage.style.display = 'block';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.mainProductVideoContainer.style.display = 'none';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.mainProductImage.src = variation.image;
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  t });
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const firstBundleOption = dom.interactiveBundleSelector.querySelector('input[type="checkbox"]');
s Â  Â  Â  Â  Â  if (firstBundleOption) {
Â  Â  Â  Â  Â  Â  Â  Â  firstBundleOption.checked = true;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â  updateBundleSummary();
Â  Â  }
Â  Â Â 
Â  Â  // FUNCTION renderReviews() REMOVED
Â  Â Â 
Â  Â  function renderRelatedProducts() {
Â  Â  Â  Â  const grid = dom.relatedProductsGrid;
Â  Â  Â  Â  if (!grid) return;

Â  Â  Â  Â  grid.innerHTML = relatedProductsData.map(product => `
Â  Â  Â  Â  Â  Â  <a href="${product.url}" class="related-product-card text-gray-900 no-underline">
Â  Â  Â  Â  Â  Â  Â  Â  <img src="${product.image}" alt="${product.name}">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="related-product-card-info">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4 class="text-sm font-semibold">${product.name}</h4>
Ã‚ Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </a>
Â  Â  Â  Â  `).join('');
Â  Â  }

Â  Â  function startFlashSaleTimer() {
Â  Â  Â  Â  let duration = 20 * 60;
Â  Â  Â  Â  clearInterval(flashSaleTimerInterval);
Â  Â  Â  Â  flashSaleTimerInterval = setInterval(() => {
Â  Â  Ã‚ Â  Â  Â  if (duration <= 0) {
Â  Â  Â  Â  Â  Â  Â  Â  clearInterval(flashSaleTimerInterval);
Â  Â  Â  Â  Â  Â  Â  Â  dom.countdownTimer.textContent = "00:00:00";
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  duration--;
Â  Â  Â  Â  Â  Â  const h = String(Math.floor(duration / 3600)).padStart(2, '0');
D Â  Â  Â  Â  Â  const m = String(Math.floor((duration % 3600) / 60)).padStart(2, '0');
Â  Â  Â  Â  Â  Â  const s = String(duration % 60).padStart(2, '0');
Â  Â  Â  Â  Â  Â  dom.countdownTimer.textContent = `${h}:${m}:${s}`;
Â  Â  Â  Â  }, 1000);
Â  Â  }
Â  Â Â 
Â  Â  function startCartTimer() {
Â  Â  Â  s Â  let duration = 10 * 60;
Â  Â  Â  Â  clearInterval(cartTimerInterval);Â 
Â  Â  Â  Â  cartTimerInterval = setInterval(() => {
Â  Â  Â  Â  Â  Â  if (duration <= 0) {
Â  Â  Â  Â  Â  Â  Â  Â  clearInterval(cartTimerInterval);
Â  Â  Â  Â  Â  Â  Â  Â  if(dom.cartTimer) dom.cartTimer.textContent = "00:00";
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Ã‚ Â  Â  Â  }
Â  Â  Â  Â  Â  Â  duration--;
Â  Â  Â  Â  Â  Â  const m = String(Math.floor(duration / 60)).padStart(2, '0');
Ã‚ Â  Â  Â  Â  Â  const s = String(duration % 60).padStart(2, '0');
Â  Â  Â  Â  Â  Â  if(dom.cartTimer) dom.cartTimer.textContent = `${m}:${s}`;
Â  Â  Â  Â  }, 1000);
Â  Â  }
Â  Â Â 
Â  Â  function startSocialProof() {
Â  Â  Â  Â  const locations = ["Miami, FL", "Los Angeles, CA", "London, UK", "Houston, TX"];
Ã‚ Â  Â  Â  setInterval(() => {
Â  Â  Â  Â  Â  Â  const name = product.name.split(' ').slice(0, 2).join(' ');
Â  Â  Â  Â  Â  Â  const loc = locations[Math.floor(Math.random() * locations.length)];
Â  Â  Â  Â  Â  Â  if (dom.socialProofPopup) {
Â  Â  Â  Â  Â  Â  Â  Â  dom.socialProofPopup.innerHTML = `ðŸ”¥ Someone from <b>${loc}</b> just purchased a ${name}!`;
Ã‚ nbsp; Â  Â  Â  Â  Â  Â  dom.socialProofPopup.classList.add('show');
Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => { dom.socialProofPopup.classList.remove('show'); }, 5000);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }, 15000);
Â  Â  }
Â  Â Â 
Â  Â  function initializePaymentMessage() {
Â  Â  Â  Â  if (!product.bundlePrices || product.bundlePrices.length === 0) return;
Â  Â  Â  Â Â 
Â  Â  Â  Â  const initialPriceInCents = Math.round(parseFloat(product.bundlePrices[0].replace('$', '')) * 100);
Â  Â  Â  Â  if (initialPriceInCents <= 0) return;

Â  Â  Â  Â  const options = {
Â  Â  Â  Â  Â  Â  amount: initialPriceInCents,
Ã‚ Â  Â  Â  Â  Â  currency: 'USD',
Â  Â  Â  Â  };

Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  paymentMessage = elements.create('paymentMethodMessaging', options);
Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  console.error("Error creating payment message element:", e);
Â  Â  Â  Â  Â  Â  return;
Â  Â  What Â  }

Â  Â  Â  Â  const mountPoint = dom.paymentMethodMessaging;
Â  Â  Â  Â  if (mountPoint) {
Â  Â  Â  Â  Â  Â  paymentMessage.mount(mountPoint);
Â  Â  Â  Â  }
Â  Â  }

Â  Â  function initializeApp() {
Â  Â  Â  Â  loadState();
Â  Â  Â  Â  renderProduct();Â 
Â  Â  Â  Â  // renderReviews(); // <-- REMOVED
Â  Â  Â  Â  renderCart();Â 
Â  Â  Â  Â  renderRelatedProducts();
Â  Â  Â  Â  initializePaymentMessage();Â 
Â  Â  Â  Â  startFlashSaleTimer();Â 
Â  Â  Â  Â  startSocialProof();

Â  Â  Â  Â  dom.addToCartButton.addEventListener('click', addToCart);
Â  Â  Â  Â  dom.interactiveBundleSelector.addEventListener('change', updateBundleSummary);
Â  Â  Â  Â Â 
Â  Â  Â  Â  const openCart = () => { if(dom.cartPanel) { dom.cartPanel.classList.add('open'); dom.cartOverlay.classList.add('open'); }};
A Â  Â  Â  if(dom.publicCartButton) dom.publicCartButton.addEventListener('click', openCart);
Â  Â  Â  Â Â 
Â  Â  Â  Â  const closeCart = () => { if(dom.cartPanel) { dom.cartPanel.classList.remove('open'); dom.cartOverlay.classList.remove('open'); }};
What Â  Â  if(dom.closeCartBtn) dom.closeCartBtn.addEventListener('click', closeCart);
Â  Â  Â  Â  if(dom.cartOverlay) dom.cartOverlay.addEventListener('click', closeCart);

Â  Â  Â  Â  if(dom.cartItemsContainer) {
Â  Â  Â  Â  Â  Â  dom.cartItemsContainer.addEventListener('click', (e) => {
Â  Â  Â  Â  Â  Â  Â  Â  if (e.target.matches('.remove-item-btn')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const variantIdToRemove = e.target.dataset.variantId;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  cart = cart.filter(item => item.variantId !== variantIdToRemove);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  saveState();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  renderCart();
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }

Â  Â  Â  Â  if(dom.popupContinueShopping) dom.popupContinueShopping.addEventListener('click', () => { dom.addToCartPopup.style.display = 'none'; });
Methods Â  Â  if(dom.popupViewCart) dom.popupViewCart.addEventListener('click', () => { dom.addToCartPopup.style.display = 'none'; openCart(); });
Â  Â  Â  Â  if(dom.closePopupBtn) dom.closePopupBtn.addEventListener('click', () => { dom.addToCartPopup.style.display = 'none'; });

Â  Â  Â  Â  if(dom.checkoutBtn) {
Â  Â  Â  Â  Â  Â  dom.checkoutBtn.addEventListener('click', async () => {
Â  Â  Â  Â  Â  Â  Â  Â  if (cart.length === 0) return;
Â  t Â  Â  Â  Â  Â  Â  dom.checkoutBtn.textContent = 'Connecting...';
Â  Â  Â  Â  Â  Â  Â  Â  dom.checkoutBtn.disabled = true;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  fbq('track', 'InitiateCheckout');Two
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const line_items = cart.map(item => ({
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  price_data: { currency: 'usd', product_data: { name: `${item.name} (${item.variantText})`, images: [item.image] }, unit_amount: Math.round(parseFloat(item.price.replace('$', '')) * 100) },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  quantity: item.quantity,
Â  Â  Â  Â  Â  Â  Â  Â  }));

Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const response = await fetch(CHECKOUT_SESSION_URL, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ items: line_items }) });
Methods Â  Â  Â  Â  Â  Â  Â  if (!response.ok) throw new Error(`Server error: ${response.statusText}`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const { url } = await response.json();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (url) window.location.href = url;
What Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error('Checkout error:', error);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â alert('Could not connect to checkout. Please try again.');
Â  Â  Â  Â  Â  Â  Â  Â  } finally {
Â  Â  Â  Â  Â  Â  t Â  Â  Â  dom.checkoutBtn.textContent = 'Pay with Card';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.checkoutBtn.disabled = false;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }
Â  Â  }

Â  Â  initializeApp();
});
</script>
</body>
</html>
