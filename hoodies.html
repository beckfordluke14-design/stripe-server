<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ATF Signature Hoodie</title>
    <script src="https://js.stripe.com/v3/"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap" rel="stylesheet">

    <script async src="https://www.googletagmanager.com/gtag/js?id=GA_MEASUREMENT_ID"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'GA_MEASUREMENT_ID');
    </script>

    <script>
      !function(f,b,e,v,n,t,s)
      {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
      n.callMethod.apply(n,arguments):n.queue.push(arguments)};
      if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
      n.queue=[];t=b.createElement(e);t.async=!0;
      t.src=v;s=b.getElementsByTagName(e)[0];
      s.parentNode.insertBefore(t,s)}(window, document,'script',
      'https://connect.facebook.net/en_US/fbevents.js');
      fbq('init', '757946737591863');
      fbq('track', 'PageView');
    </script>
    <noscript><img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id=757946737591863&ev=PageView&noscript=1"/></noscript>
    <style>
        /* Font Family Updated */
        body { font-family: "Bebas Neue", sans-serif; transition: background-color 0.3s ease; background-size: cover; background-position: center; background-attachment: fixed; }
        body[data-theme="light"], body { --color-urgent: #ef4444; --color-accent: #4f46e5; --color-accent-hover: #4338ca; --color-accent-border: #4f46e5; }
        body[data-theme="dark"] { --color-urgent: #d946ef; --color-accent: #ec4899; --color-accent-hover: #db2777; --color-accent-border: #ec4899; }
        .add-to-cart-button { background-color: var(--color-accent); transition: background-color 0.3s; }
        .add-to-cart-button:hover { background-color: var(--color-accent-hover); }
        .text-highlight { color: var(--color-accent); }
        #cart-panel { position: fixed; top: 0; right: -100%; width: 100%; max-width: 400px; height: 100%; background-color: white; color: #333; box-shadow: -10px 0 30px rgba(0,0,0,0.1); z-index: 110; transition: right 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94); display: flex; flex-direction: column; }
        #cart-panel.open { right: 0; }
        #cart-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.6); z-index: 105; }
        #cart-overlay.open { display: block; }
        .modal { display: none; position: fixed; z-index: 120; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.6); }
        .modal-content { background-color: #fefefe; color: #333; margin: 2% auto; padding: 2rem; border: 1px solid #888; width: 90%; max-width: 600px; border-radius: 10px; max-height: 90vh; overflow-y: auto;}
        .close-modal { color: #aaa; float: right; font-size: 28px; font-weight: bold; cursor: pointer; }
        #social-proof-popup { display: none; position: fixed; bottom: 20px; left: 20px; background-color: white; color: #333; padding: 15px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.2); z-index: 200; opacity: 0; transform: translateY(20px); transition: opacity 0.5s, transform 0.5s; }
        #social-proof-popup.show { display: block; opacity: 1; transform: translateY(0); }

        #public-cart-button { position: fixed; bottom: 20px; right: 20px; background-color: var(--color-accent); color: white; width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 12px rgba(0,0,0,0.2); cursor: pointer; z-index: 100; transition: transform 0.2s; }
        #public-cart-button:hover { transform: scale(1.1); }
        #public-cart-badge { position: absolute; top: -5px; right: -5px; background-color: var(--color-urgent); color: white; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: bold; }

        .bundle-image-option input:checked + label { border-color: var(--color-accent); box-shadow: 0 0 0 3px var(--color-accent); }
        .bundle-image-option input:checked + label .bundle-checkmark { opacity: 1; transform: scale(1); }

        .image-thumb-nav { display: flex; gap: 0.5rem; margin-top: 1rem; justify-content: center; }
        .image-thumb { width: 60px; height: 60px; object-cover; border-radius: 0.25rem; cursor: pointer; border: 2px solid transparent; opacity: 0.7; transition: all 0.2s; }
        .image-thumb:hover { opacity: 1; }
        .image-thumb.active { opacity: 1; border-color: var(--color-accent); }

        #size-selector label { display: inline-block; }
        #size-selector input[type="radio"].peer:checked + label {
            background-color: var(--color-accent);
            color: white;
            border-color: var(--color-accent);
        }

        .related-product-card {
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            overflow: hidden;
            transition: box-shadow 0.2s;
            text-decoration: none;
        }
        .related-product-card:hover {
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        .related-product-card img {
            aspect-ratio: 1 / 1;
            object-fit: cover;
            width: 100%;
        }
        .related-product-card-info {
            padding: 0.75rem;
            text-align: center;
        }
    </style>
</head>
<body data-theme="dark">

    <div id="public-cart-button">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" /></svg>
        <span id="public-cart-badge">0</span>
    </div>
    <div id="social-proof-popup"></div>
    <div id="cart-overlay"></div>

    <div id="cart-panel">
        <div class="flex justify-between items-center p-4 border-b">
            <h2 class="text-xl font-bold">Your Cart</h2>
            <button id="close-cart-btn" class="text-2xl">&times;</button>
        </div>
        <div class="p-4 bg-yellow-100 text-center">
            <p class="font-semibold text-yellow-800" style="font-family: sans-serif;">Your items are reserved for <span id="cart-timer" class="font-bold">10:00</span>!</p>
        </div>
        <div id="cart-items-container" class="flex-grow p-4 overflow-y-auto"></div>
        <div class="p-4 border-t space-y-4">
            <div class="flex justify-between font-bold text-lg">
                <span>Subtotal</span>
                <span id="cart-subtotal">$0.00</span>
            </div>
            <p class="text-sm text-gray-500 text-center" style="font-family: sans-serif;">Free Shipping on all orders!</p>
            <button id="checkout-btn" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 rounded-lg text-lg">Pay with Card</button>
        </div>
    </div>

    <div id="theme-wrapper">
        <div id="page-container">
            <header class="py-4 absolute top-0 left-0 w-full z-10">
                <div class="container mx-auto px-4 flex justify-center">
                    <a href="/home.html"><img id="header-logo" alt="Brand Logo" class="h-10"></a>
                </div>
            </header>
            <div class="container mx-auto p-4 max-w-5xl pt-20">

                <div id="urgent-cta" class="text-center mb-6 pt-12">
                    <h3 id="cta-headline" class="text-2xl font-bold text-highlight"></h3>
                    <p id="cta-subheadline" class="text-gray-500" style="font-family: sans-serif;"></p>
                </div>
                <div class="bg-white rounded-xl shadow-2xl overflow-hidden">
                    <div class="md:flex">
                        <div id="media-container" class="md:w-1/2 p-4">
                            <img id="main-product-image" class="w-full aspect-square object-cover rounded-lg shadow-md" src="" alt="Main Product Image">
                            <div id="image-thumb-nav" class="image-thumb-nav"></div>
                        </div>
                        <div id="product-details-container" class="p-8 md:w-1/2 flex flex-col justify-between">
                            <div>
                                <div id="product-badge" class="uppercase tracking-wide text-sm text-highlight font-semibold"></div>
                                <h2 id="product-name" class="text-3xl font-bold text-gray-900 mt-2"></h2>
                                <div class="mt-6 flex items-baseline gap-4">
                                    <div><span class="text-gray-500 text-sm">Total Price</span><span id="product-price" class="text-4xl font-bold text-gray-900"></span></div>
                                    <span id="product-original-price" class="hidden"></span> </div>
                                <div class="mt-2 text-sm text-green-600 font-semibold flex items-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" viewBox="0 0 20 20" fill="currentColor">
                                      <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                                    </svg>
                                    <span>+ Free Shipping</span>
                                </div>

                                <div id="interactive-bundle-selector" class="mt-6 space-y-3"></div> <div id="size-selector" class="mt-6"></div> <div id="bundle-summary" class="mt-4 space-y-2" style="display: none;">
                                    <h4 class="font-bold text-lg text-gray-800">Your Selection:</h4>
                                    <div id="bundle-summary-items" class="text-gray-600" style="font-family: sans-serif;"></div>
                                </div>
                            </div>
                            <div class="mt-8">
                                <button id="add-to-cart-button" class="add-to-cart-button w-full text-white font-bold py-4 px-6 rounded-lg text-xl shadow-lg">Add to Cart</button>
                            </div>
                        </div>
                    </div>
                    <div id="related-products-section" class="p-8 border-t border-gray-200">
                        <h3 class="text-lg font-bold mb-4 text-gray-900">You May Also Like</h3>
                        <div id="related-products-grid" class="grid grid-cols-3 gap-4">
                        </div>
                    </div>
                </div>
                <div class="mt-12 space-y-8">
                    <div id="shipping-section" class="bg-white p-8 rounded-lg shadow-md">
                        <h3 class="text-2xl font-bold mb-4 text-gray-900">Shipping Information</h3>
                        <p class="text-gray-700" style="font-family: sans-serif;">Your order will be processed within 24 hours. **Expected shipping time is 2.5 weeks.** You'll receive a tracking number as soon as it ships.</p>
                    </div>
                    </div>
            </div>
        </div>
    </div>

    <div id="add-to-cart-popup" class="modal">
        <div class="modal-content text-center max-w-md">
            <span class="close-modal" id="close-popup-btn">&times;</span>
            <h3 class="text-2xl font-bold text-green-600 mb-4">Successfully Added!</h3>
            <img id="popup-product-image" src="" alt="Product Image" class="w-32 h-32 object-cover mx-auto rounded-lg mb-4">
            <p id="popup-message" class="text-gray-700 mb-6"></p>
            <div class="space-y-3">
                <button id="popup-view-cart" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 rounded-lg">View Cart & Checkout</button>
                <button id="popup-continue-shopping" class="w-full text-gray-600 hover:text-indigo-600 font-semibold py-2">Continue Shopping</button>
            </div>
        </div>
    </div>

<script src="/cart.js"></script> <script>
document.addEventListener('DOMContentLoaded', () => {
    // --- CONFIGURATION ---
    const LOGO_URL_WHITE = 'https://i.imgur.com/7B5NkbX.png';
    const LOGO_URL_BLACK = 'https://i.imgur.com/mY9JuRX.png';
    // CHECKOUT_SESSION_URL defined globally in cart.js if needed there

    // --- STATE MANAGEMENT ---
    let product = {};
    // Relies on global window.cart from cart.js
    const appStateKey = 'atfCart_v1'; // Use global key
    // cartTimerInterval managed globally by cart.js

    // --- DATA ---
    const initialProduct = {
        name: 'ATFV12 HOODIE',
        ctaHeadline: 'The New Standard.',
        ctaSubheadline: 'Comfort and design, unified.',
        theme: 'dark',
        bundlePrices: ['$59.95'], // Price for a single hoodie
        variations: {
            'Design': [
                { option: 'ICE', images: { front: 'https://i.imgur.com/TZw6FIE.png', back: 'https://i.imgur.com/CIpigzw.png' } },
                { option: 'OOTER', images: { front: 'https://i.imgur.com/eaGeEEL.png', back: 'https://i.imgur.com/lwbTzZP.png' } },
                { option: 'PREE', images: { front: 'https://i.imgur.com/tUMU6TR.png', back: 'https://i.imgur.com/d5rcFj6.png' } }
            ],
            'Size': [
                { option: 'S' }, { option: 'M' }, { option: 'L' }, { option: 'XL' }, { option: '2XL' }
            ]
        }
    };
    const relatedProductsData = [
        { name: 'V1 - Turbo Edition Mask', image: 'https://i.imgur.com/ghpj3Nm.png', url: '/index.html' },
        { name: 'V1 - Burble Edition Mask', image: 'https://i.imgur.com/9QcKSwf.png', url: '/index.html' },
        { name: 'V1 - Burnout Edition Mask', image: 'https://i.imgur.com/lLIgQjD.png', url: '/index.html' }
    ];

    // --- CORE FUNCTIONS ---
    const dom = new Proxy({}, { get: (_, id) => document.getElementById(id.replace(/([A-Z])/g, "-$1").toLowerCase()) });

    function updateImages(designVariation) {
        if (!designVariation || !designVariation.images || !dom.mainProductImage || !dom.imageThumbNav) return;

        dom.mainProductImage.src = designVariation.images.front;
        dom.mainProductImage.alt = `${product.name} - ${designVariation.option} - Front`;

        const thumbNav = dom.imageThumbNav;
        thumbNav.innerHTML = ''; // Clear previous thumbs

        // --- Create Front Thumbnail ---
        const frontThumb = document.createElement('img');
        frontThumb.src = designVariation.images.front;
        frontThumb.alt = `Front View`;
        frontThumb.className = 'image-thumb active'; // Start with front active
        frontThumb.addEventListener('click', () => {
           if (dom.mainProductImage) dom.mainProductImage.src = designVariation.images.front;
           if (thumbNav) thumbNav.querySelectorAll('.image-thumb').forEach(t => t.classList.remove('active'));
           frontThumb.classList.add('active');
        });
        thumbNav.appendChild(frontThumb);

        // --- Create Back Thumbnail ---
        const backThumb = document.createElement('img');
        backThumb.src = designVariation.images.back;
        backThumb.alt = `Back View`;
        backThumb.className = 'image-thumb';
        backThumb.addEventListener('click', () => {
           if (dom.mainProductImage) dom.mainProductImage.src = designVariation.images.back;
           if (thumbNav) thumbNav.querySelectorAll('.image-thumb').forEach(t => t.classList.remove('active'));
           backThumb.classList.add('active');
        });
        thumbNav.appendChild(backThumb);
    }


    // --- !!! UPDATED addToCart Function for Hoodie Page !!! ---
    function addToCart() {
        // Get selected design (radio button)
        const selectedDesignInput = document.querySelector('#interactive-bundle-selector input[name="designSelection"]:checked');
        // Get selected size (radio button)
        const selectedSizeInput = document.querySelector('#size-selector input[name="sizeSelection"]:checked');

        // --- VALIDATION ---
        if (!selectedDesignInput) {
            alert("Please select a design.");
            return;
        }
        if (!selectedSizeInput) {
            alert("Please select a size.");
            return;
        }

        // --- GET PRODUCT DETAILS ---
        const selectedDesignName = selectedDesignInput.dataset.name;
        const selectedSize = selectedSizeInput.value;
        const designData = product.variations['Design'].find(d => d.option === selectedDesignName);
        const frontImage = designData ? designData.images.front : 'https://placehold.co/100x100';
        const price = parseFloat(product.bundlePrices[0].replace('$', '')); // Hoodie price
        const variantId = `${selectedDesignName}|${selectedSize}|${Date.now()}`; // Unique ID for this specific variant combo

        // --- ADD ITEM TO GLOBAL CART ARRAY ---
        window.cart.push({ // Use window.cart
            productId: 'hoodieProduct', // Consistent ID for hoodies
            variantId: variantId,
            name: product.name,
            price: `$${price.toFixed(2)}`,
            image: frontImage,
            variantText: `${selectedDesignName} / ${selectedSize}`,
            quantity: 1
        });

        // --- ENHANCED FB PIXEL CODE for Hoodie ---
        if (typeof fbq === 'function') { // Check if fbq is loaded
            try {
                fbq('track', 'AddToCart', {
                    content_ids: [variantId], // Use the unique variant ID created above
                    content_name: `${product.name} - ${selectedDesignName} / ${selectedSize}`, // More specific name
                    content_category: 'Apparel & Accessories > Clothing > Outerwear > Hoodies & Sweatshirts', // Optional: Add category
                    content_type: 'product', // Use 'product' as only one is added at a time
                    value: price, // Use the numeric price variable
                    currency: 'USD' // IMPORTANT: Change 'USD' if needed
                });
            } catch (e) {
                console.error("FB Pixel AddToCart Error:", e);
            }
        }
        // --- END OF ENHANCED FB PIXEL CODE ---

        // Use global functions if they exist
        if (window.saveState) window.saveState();
        if (window.renderCart) window.renderCart();

        showItemAddedPopup({ mediaUrl: frontImage }, `Added <strong>1 item</strong> to your cart!`);

        if (window.startCartTimer) window.startCartTimer();
    }
    // --- !!! END of UPDATED addToCart Function !!! ---


    function showItemAddedPopup(popupProduct, message) {
        if (!dom.addToCartPopup) return;
        clearTimeout(dom.popupTimeout);
        if(dom.popupProductImage) dom.popupProductImage.src = popupProduct.mediaUrl || 'https://placehold.co/128x128';
        if(dom.popupMessage) dom.popupMessage.innerHTML = message;
        dom.addToCartPopup.style.display = 'block';
        // Auto close after 5 seconds
        dom.popupTimeout = setTimeout(() => { if(dom.addToCartPopup) dom.addToCartPopup.style.display = 'none'; }, 5000);
    }

    function renderProduct() {
        product = initialProduct; // Load initial product data
        document.body.dataset.theme = product.theme || 'light';
       if(dom.headerLogo) dom.headerLogo.src = (product.theme === 'light') ? LOGO_URL_BLACK : LOGO_URL_WHITE;
       if(dom.productName) dom.productName.textContent = product.name;
       if(dom.ctaHeadline) dom.ctaHeadline.textContent = product.ctaHeadline;
       if(dom.ctaSubheadline) dom.ctaSubheadline.textContent = product.ctaSubheadline;
       if(dom.productBadge) dom.productBadge.textContent = 'Signature Collection';

        // Set initial price display
        if (dom.productPrice) dom.productPrice.textContent = product.bundlePrices[0]; // Display the single hoodie price

        // Render Design Selector (Radio Buttons for Hoodie)
        if (dom.interactiveBundleSelector) {
             dom.interactiveBundleSelector.innerHTML = '<h4 class="font-bold text-lg text-gray-800 mb-2">Choose Your Design:</h4><div class="grid grid-cols-2 sm:grid-cols-3 gap-3"></div>';
             const gridContainer = dom.interactiveBundleSelector.querySelector('.grid');
             const designKey = 'Design';

             if (product.variations && product.variations[designKey]) {
                 product.variations[designKey].forEach((variation, index) => {
                     const optionId = `design-opt-${variation.option.replace(/\s+/g, '-')}`;
                     const optionEl = document.createElement('div');
                     optionEl.className = 'bundle-image-option'; // Keep class for styling
                     optionEl.innerHTML = `
                         <input type="radio" name="designSelection" id="${optionId}" data-name="${variation.option}" class="sr-only peer">
                         <label for="${optionId}" class="block relative border-2 border-gray-200 rounded-lg cursor-pointer transition-all p-1 peer-checked:border-indigo-600 peer-checked:ring-2 peer-checked:ring-indigo-600">
                             <img src="${variation.images.front}" class="w-full h-24 object-cover rounded-md">
                             <p class="text-center text-sm font-semibold mt-1 text-gray-800">${variation.option}</p>
                             <div class="bundle-checkmark absolute top-1 right-1 h-6 w-6 bg-white/70 rounded-full flex items-center justify-center opacity-0 transform scale-75 transition-all">
                                <svg class="h-4 w-4 text-white" style="fill: var(--color-accent);" viewBox="0 0 20 20"><path d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"/></svg>
                             </div>
                         </label>
                     `;
                     gridContainer.appendChild(optionEl);

                     // Add event listener to update images when a design is selected
                     const inputElement = optionEl.querySelector('input');
                     if (inputElement) {
                         inputElement.addEventListener('change', () => {
                             updateImages(variation);
                         });
                     }


                     // Set the first design as default checked and update images
                     if (index === 0) {
                         if (inputElement) inputElement.checked = true;
                         updateImages(variation); // Initial image load
                     }
                 });
             }
        }


        // Render Size Selector
        const sizeKey = 'Size';
        const sizeSelectorContainer = dom.sizeSelector;
        if (sizeSelectorContainer && product.variations && product.variations[sizeKey]) {
            sizeSelectorContainer.innerHTML = `<h4 class="font-bold text-lg text-gray-800 mb-2">Select Size:</h4><div class="flex flex-wrap gap-3"></div>`;
            const sizeGrid = sizeSelectorContainer.querySelector('.flex');

            product.variations[sizeKey].forEach((sizeVar) => {
                const sizeId = `size-opt-${sizeVar.option}`;
                const sizeLabel = document.createElement('label');
                sizeLabel.htmlFor = sizeId;
                sizeLabel.className = 'cursor-pointer border border-gray-300 rounded px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100 peer-checked:bg-indigo-600 peer-checked:text-white peer-checked:border-transparent transition-colors';
                sizeLabel.textContent = sizeVar.option;

                const sizeInput = document.createElement('input');
                sizeInput.type = 'radio';
                sizeInput.name = 'sizeSelection';
                sizeInput.id = sizeId;
                sizeInput.value = sizeVar.option;
                sizeInput.className = 'sr-only peer';

                // Set default size (e.g., Medium)
                if (sizeVar.option === 'M') {
                    sizeInput.checked = true;
                }

                sizeGrid.appendChild(sizeInput);
                sizeGrid.appendChild(sizeLabel);
            });
        } else if (sizeSelectorContainer) {
             sizeSelectorContainer.innerHTML = ''; // Clear if no sizes
         }
    }


    function renderRelatedProducts() {
        const grid = dom.relatedProductsGrid;
        if (!grid) return;

        grid.innerHTML = relatedProductsData.map(product => `
            <a href="${product.url}" class="related-product-card text-gray-900 no-underline">
                <img src="${product.image}" alt="${product.name}">
                <div class="related-product-card-info">
                    <h4 class="text-sm font-semibold">${product.name}</h4>
                </div>
            </a>
        `).join('');
    }

    function startSocialProof() {
        const locations = ["Miami, FL", "Los Angeles, CA", "London, UK", "Houston, TX"];
        const intervalId = setInterval(() => { // Store interval ID
            // Check if product data is loaded before accessing name
             if (!product || !product.name) return;

            const productNameRef = product.name;
            const name = productNameRef.split(' ').slice(0, 2).join(' '); // Use first two words
            const loc = locations[Math.floor(Math.random() * locations.length)];
            if (dom.socialProofPopup) {
                dom.socialProofPopup.innerHTML = `ðŸ”¥ Someone from <b>${loc}</b> just purchased a ${name}!`;
                dom.socialProofPopup.classList.add('show');
                setTimeout(() => {
                    if(dom.socialProofPopup) dom.socialProofPopup.classList.remove('show');
                 }, 5000); // Hide after 5 seconds
            } else {
                 // If popup element doesn't exist, stop trying
                 clearInterval(intervalId);
             }
        }, 20000); // Adjusted interval to 20 seconds
    }

    // Main initialization function for THIS page's specific logic
    function initializeThisPage() {
        // Load initial data (local to this page)
        product = initialProduct;

        // Render page elements specific to this page
        renderProduct(); // This now renders selectors and sets defaults
        renderRelatedProducts();
        startSocialProof();

        // Add event listeners specific to this page
        if(dom.addToCartButton) dom.addToCartButton.addEventListener('click', addToCart);

        // Popup listeners remain specific to this page's popup element IDs
        if(dom.popupContinueShopping) dom.popupContinueShopping.addEventListener('click', () => { if(dom.addToCartPopup) dom.addToCartPopup.style.display = 'none'; });
        if(dom.popupViewCart) dom.popupViewCart.addEventListener('click', () => { if(dom.addToCartPopup) dom.addToCartPopup.style.display = 'none'; if(window.openCart) window.openCart(); }); // Use global
        if(dom.closePopupBtn) dom.closePopupBtn.addEventListener('click', () => { if(dom.addToCartPopup) dom.addToCartPopup.style.display = 'none'; });

        // Initial render of the global cart display AFTER cart.js has loaded
        if (window.renderCart) {
            window.renderCart();
        } else {
            console.warn("Global renderCart function not found after loading cart.js");
        }
    }

    // Wait for the DOM and ensure cart.js is loaded before initializing page logic
    if (document.readyState === 'loading') {
        // We might need to wait for cart.js script tag to load first
        // The call is now handled by the onload handler of the script tag below
    } else {
        // DOM is ready, maybe cart.js loaded first or simultaneously
        // Still better to wait for onload or ensure cart.js is defined
        if (window.renderCart) { // Check if cart functions exist
            initializeThisPage();
        } else {
            console.warn("DOM ready but cart.js functions not found yet.");
            // Wait a fraction longer just in case
            setTimeout(initializeThisPage, 50);
        }
    }


}); // End of main DOMContentLoaded wrapper

</script>
</body>
</html>
